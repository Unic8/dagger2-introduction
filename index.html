<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!--This one seems to work all the time, but really small on ipad-->
    <!--<meta name="viewport" content="initial-scale=0.4">-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" media="all" href="theme/css/default.css">
    <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
          href="theme/css/phone.css">
    <base target="_blank">
    <!-- This amazingness opens all links in a new tab. -->
    <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

    <slide class="logoslide nobackground">
        <article class="flexbox vcenter">
            <span><img id="front_logo" src="images/gdg-hamburg-android/logo.png"></span>
        </article>
    </slide>

    <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="images/gdg-hamburg-android/small.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
        <hgroup class="auto-fadein">
            <h1 data-config-title><!-- populated from slide_config.json --></h1>

            <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>

            <p data-config-presenter><!-- populated from slide_config.json --></p>
        </hgroup>
    </slide>
    <slide class="fill nobackground" style="background-image: url(images/dagger2/cpt-america.jpg)">
        <hgroup>
            <h2 class="white">What is Dependency Injection?</h2>
        </hgroup>
    </slide>
    <slide>
        <hgroup>
            <h2>Example for this talk:</h2>
        </hgroup>
        <article class="smaller">
            <ul class="build">
                <li><pre class="prettyprint" data-lang="java">
public class MainActivity extends AppCompatActivity {
    ...
    private void print(CharD d, CharA a, CharG g, CharE e, CharR r) {
        text.setText(String.format("%s%s%s%s%s%s2", d, a, g, g, e, r));
    }
    ...
}
                </pre></li>
                <li><pre class="prettyprint" data-lang="java">
public class CharD {
    ...
    @Override
    public String toString() {
        return "D";
    }
}
                </pre>
            </li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Simple Dependencies...</h2>
        </hgroup>
        <article class="smaller">
            <ul class="build">
                <li><pre class="prettyprint" data-lang="java">
public class CharA {
    public CharA() {
        Log.d("CharA", "Constructor of: CharA");
    }
    ...
}
                </pre></li>
                <li><pre class="prettyprint" data-lang="java">
public class CharB {
    private final CharA ch;
    public CharB(CharA ch) {
        this.ch = ch;
        Log.d("CharB", "Constructor of: CharB");
    }
    ...
}
                </pre></li>
                <li>... and so on. Up to R</li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>...add a bit of complexity!</h2>
        </hgroup>
        <article class="smaller">
            <ul class="build">
                <li><pre class="prettyprint" data-lang="java">
public class CharK {
    private final CharJ ch;
    private final Activity activity;
    public CharK(Activity activity, CharJ ch) {
        this.ch = ch;
        this.activity = activity;
        Log.d("CharK", "Constructor of: CharK");
    }
    ....
                </pre></li>
                <li><pre class="prettyprint" data-lang="java">
public class CharO {
    private final CharN ch;
    private final SharedPreferences preferences;
    public CharO(SharedPreferences preferences, CharN ch) {
        this.ch = ch;
        this.preferences = preferences;
        Log.d("CharO", "Constructor of: CharO");
    }
    ...
                </pre></li>
            </ul>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Dependency Graph</h2>

            <h3>Not difficult, but complex already</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-full.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Dependency Graph</h2>

            <h3>Not difficult, but complex already</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-simplified.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>How does that look like in Code:</h2>

            <h3>without Dependency Injection</h3>
        </hgroup>
        <article class="smaller">
            <p>Github Tag: <a href="https://github.com/andretietz/dagger2-introduction/blob/no-di/app/src/main/java/eu/unicate/dagger2showcase/MainActivity.java">no-di</a></p>
      <pre class="prettyprint" data-lang="java">
<b>CharA a = new CharA();</b>
CharB b = new CharB(a);
CharC c = new CharC(b);
<b>CharD d = new CharD(c);
CharE e = new CharE(d);</b>
CharF f = new CharF(e);
<b>CharG g = new CharG(f);</b>
CharH h = new CharH(g);
CharI i = new CharI(h);
CharJ j = new CharJ(i);
CharK k = new CharK(activity, j);
CharL l = new CharL(k);
CharM m = new CharM(activity, l);
CharN n = new CharN(m);
CharO o = new CharO(PreferenceManager.getDefaultSharedPreferences(activity), n);
CharP p = new CharP(o);
CharQ q = new CharQ(activity, p);
<b>CharR r = new CharR(q);
print(d, a, g, g, e, r);</b>
</pre>
            <img style="position: absolute; width:400px; left: 600px; top: 100px" src="images/dagger2/meme-wtf.jpg"/>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Dependency Injection</h2>
            <h3>... using Dagger2</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/use-di.jpg"></span>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Dagger 2 Basics</h2>

            <h3>It's everything about...</h3>
        </hgroup>
        <article>
            <ul class="build">
                <li>Modules</li>
                <li>Components</li>
                <li>Scopes</li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Modules</h2>
            <h3>Buckets providing Objects</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-modules.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Components</h2>
            <h3>Expose Objects from Modules</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-components.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Components</h2>
            <h3>Expose Objects from Modules</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/modules-components-relation.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Components</h2>
            <h3>Expose Objects from Modules</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/modules-components-relation2.png"></span>
        </article>
    </slide>


    <slide>
        <hgroup>
            <h2>Scoping</h2>

            <h3>Lifecycle Dependency</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-full.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Scoping</h2>

            <h3>Can we do that better?</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-optimization01.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Scoping</h2>

            <h3>Now SharedPreferences can live as long as the Application is alive.</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-optimization02.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Scoping</h2>

            <h3>Now we can classify even better!</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-optimization03.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Scoping</h2>

            <h3>Now we can classify even better!</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/hands-on.jpg"></span>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Hands on!</h2>

            <h3>What do we need to use Dagger2?</h3>
        </hgroup>
        <article class="smaller">
            <pre class="prettyprint" data-lang="groovy">
buildscript {
	repositories {
		jcenter()
	}
	dependencies {
		classpath 'com.android.tools.build:gradle:1.3.1'
		<b>classpath 'com.neenbedankt.gradle.plugins:android-apt:1.7'</b>
	}
}
            </pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Hands on!</h2>

            <h3>What do we need for that?</h3>
        </hgroup>
        <article class="smaller">
            <ul class="build">
                <li><pre class="prettyprint" data-lang="groovy">
apply plugin: 'com.android.application'
<b>apply plugin: 'com.neenbedankt.android-apt'</b>
                </pre>
                </li>
                <li><pre class="prettyprint" data-lang="groovy">
dependencies {
    ...
    // dagger 2
    <b>apt 'com.google.dagger:dagger-compiler:2.0.1' // code generation
    compile 'com.google.dagger:dagger:2.0.1' // dagger2 basics
    provided 'org.glassfish:javax.annotation:10.0-b28' // annotations</b>
    ...
                </pre>
                </li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Let's go!</h2>

            <h3>Think about Scopes first!</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-optimization03.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Creating Scopes</h2>
        </hgroup>
        <article class="flexbox vcenter">
            <ul class="build">
                <li>
                <pre class="prettyprint" data-lang="java">
@Scope
@Retention(RetentionPolicy.RUNTIME)
public @interface ApplicationScope {} // you could use Singleton instead
                </pre>
                </li>
                <li>
<pre class="prettyprint" data-lang="java">
@Scope
@Retention(RetentionPolicy.RUNTIME)
public @interface ActivityScope {}
                </pre>
                </li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Creating Modules</h2>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-final-modules.png"></span>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Creating Modules</h2>

            <h3>The Application Module</h3>
        </hgroup>
        <article class="smaller">
                            <pre class="prettyprint" data-lang="java">
@Module
public class ApplicationModule {
    private final Context context;
    public ApplicationModule(Context context) {
        this.context = context;
    }

    @Singleton
    <b>@Provides
    Context provideContext()</b> {
        return context;
    }

    @Singleton
    @Provides
    SharedPreferences providePreferences(<b>Context context</b>) {
        return PreferenceManager.getDefaultSharedPreferences(context);
    }
}
                </pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Creating Modules</h2>

            <h3>The A-J Module</h3>
        </hgroup>
        <article class="smaller">
                            <pre class="prettyprint" data-lang="java">
@Module
public class CharA2JModule {
    @Singleton
    <b>@Provides
    CharA</b> provideA() {
        return new CharA();
    }

    @Singleton
    @Provides
    CharB provideB(<b>CharA a</b>) {
        return new CharB(a);
    }
    ...
    @Singleton
    @Provides
    CharJ provideJ(CharI i) {
        return new CharJ(i);
    }
}
                </pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Creating Modules</h2>
            <h3>The Activity Module</h3>
        </hgroup>
        <article class="smaller">
                            <pre class="prettyprint" data-lang="java">
@Module
public class ActivityModule {
    private final Activity activity;

    public ActivityModule(Activity activity) {
        this.activity = activity;
    }

    @Provides
    @ActivityScope
    Activity provideActivity() {
        return activity;
    }
}
                </pre>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Creating Modules</h2>

            <h3>The K-R Module</h3>
        </hgroup>
        <article class="smaller">
                            <pre class="prettyprint" data-lang="java">
@Module
public class CharK2RModule {
    @Provides
    @ActivityScope
    <b>CharK provideK(Activity activity, CharJ j) {</b>
        return new CharK(activity, j);
    }
    ...
    @Provides
    @ActivityScope
    <b>CharO provideO(SharedPreferences preferences, CharN n) {</b>
        return new CharO(preferences, n);
    }
    ...
}
                </pre>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Creating Components</h2>

            <h3>The ApplicationComponent</h3>
        </hgroup>
        <article>
                            <pre class="prettyprint" data-lang="java">
@Singleton
@Component(modules = {CharA2JModule.class, ApplicationModule.class})
public interface ApplicationComponent {
	CharD getD();
	CharA getA();
	CharG getG();
	CharE getE();

	<b>CharJ getJ();</b>
	SharedPreferences getPreferences();
}
                </pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Why CharJ?</h2>

            <h3>CharJ is a Dependency of CharK!</h3>
        </hgroup>
        <article class="flexbox vcenter">
            <span><img src="images/dagger2/di-graph-optimization03.png"></span>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Creating Components</h2>

            <h3>The ActivityComponent</h3>
        </hgroup>
        <article>
                            <pre class="prettyprint" data-lang="java">
@ActivityScope
@Component(
    modules = {<b>ActivityModule.class</b>, CharK2RModule.class},
    dependencies = {<b>ApplicationComponent.class</b>}
)
public interface ActivityComponent {
	void inject(MainActivity activity);
	CharR getR();
}
                </pre>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Build your Project</h2>

            <h3>APT using the dagger-compiler, now generates Code</h3>
        </hgroup>
        <article class="smaller">
            <p>You can find the generated code: build/generated/source/apt/BUILDTYPE</p>
            <ul class="build">
                <li>1 Class for each Component Interface (2 for this example)</li>
                <li>1 Class for each Provides-Annotation used in Modules (21 for this example)</li>
                <li>1 Class for each "inject"-Method in your Components (1 for this example)</li>
            </ul>
            <ul class="build">
                <li>After the successful Code generation, you're good to go.</li>
            </ul>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>How to use it?</h2>

            <h3>Instantiate ApplicationComponent</h3>
        </hgroup>
        <article class="smaller">
<pre class="prettyprint" data-lang="java">
public class DaggerShowCaseApplication extends Application {
	private <b>ApplicationComponent</b> component;
	@Override
	public void onCreate() {
		super.onCreate();
		component = Dagger<b>ApplicationComponent</b>.builder()
				.applicationModule(new ApplicationModule(this))
				.build();
	}
	public ApplicationComponent getApplicationComponent() {
		return component;
	}
}
</pre>
        </article>
    </slide>

    <slide>
        <hgroup>
            <h2>Injecting Members</h2>

            <h3>Instantiate ActivityComponent</h3>
        </hgroup>
        <article class="smaller">
<pre class="prettyprint" data-lang="java">
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    DaggerActivityComponent.builder()
        .applicationComponent(
            ((DaggerShowCaseApplication) getApplication()).getApplicationComponent()
        )
        .activityModule(new ActivityModule(this))
        .build() // returns an ActivityComponent
            .inject(this);
    // start using your injected members
}
</pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Let's compare now:</h2>

            <h3>without Dependency Injection</h3>
        </hgroup>
        <article class="smaller">
      <pre class="prettyprint" data-lang="java">
CharA a = new CharA();
CharB b = new CharB(a);
CharC c = new CharC(b);
CharD d = new CharD(c);
CharE e = new CharE(d);
CharF f = new CharF(e);
CharG g = new CharG(f);
CharH h = new CharH(g);
CharI i = new CharI(h);
CharJ j = new CharJ(i);
CharK k = new CharK(activity, j);
CharL l = new CharL(k);
CharM m = new CharM(activity, l);
CharN n = new CharN(m);
CharO o = new CharO(PreferenceManager.getDefaultSharedPreferences(activity), n);
CharP p = new CharP(o);
CharQ q = new CharQ(activity, p);
CharR r = new CharR(q);
print(d, a, g, g, e, r);
</pre>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Let's compare now:</h2>

            <h3>with Dagger2</h3>
        </hgroup>
        <article class="smaller">
                    <pre class="prettyprint" data-lang="java">
@Inject CharD d;
@Inject CharA a;
@Inject CharG g;
@Inject CharE e;
@Inject CharR r;
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);
    ActivityComponent component = DaggerActivityComponent.builder()
            .applicationComponent(((DaggerShowCaseApplication) getApplication()).getApplicationComponent())
            .activityModule(new ActivityModule(this)).build();
    component.inject(this);
    print(d, a, g, g, e, r);
                </pre>
        </article>
    </slide>
    <slide>
        <hgroup class="auto-fadein">
            <h2>Additional Goodies</h2>

            <h3>You get it for free!</h3>
        </hgroup>
        <article class="smaller">
            <ul class="build">
                <li><p>Lazy is creating the object only if needed and only ones (per scope)</p>

                <pre class="prettyprint" data-lang="java">
// Before: @Inject CharD d;
// call d.get() to get the instance
@Inject Lazy&lt;CharD&gt; d;
...
                </pre>
                </li>
                <li><p>Provider creates each time you call "get" </p>
<pre class="prettyprint" data-lang="java">
// Before: @Inject CharD d;
// call d.get() to create a new instance
@Inject Provider&lt;CharD&gt; d;
                </pre>
                </li>
                <li>Both Options can be used inside Modules also!<br />Tag: <a href="https://github.com/andretietz/dagger2-introduction/blob/lazy-inside-module/app/src/main/java/eu/unicate/dagger2showcase/di/modules/CharK2RModule.java#L55">lazy-inside-module</a> </li>
            </ul>

        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Additional Goodies</h2>
            <h3>Qualifiers</h3>
        </hgroup>
        <article class="smaller">
            <p>What if a module has to return 2 different objects of the same class?<br />Let's say 2 different G's in the Word "Dagger".</p>
            <ul class="build">
                <li>Create a Qualifier.<pre class="prettyprint" data-lang="java">
@Qualifier
@Retention(RUNTIME)
public @interface GType {
	String value() default "";
}
                </pre></li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Additional Goodies</h2>
            <h3>Qualifiers</h3>
        </hgroup>
        <article class="smaller">
            <p>What if a module has to return 2 different objects of the same class?<br />Let's say 2 different G's in the Word "Dagger".</p>
            <ul>
                <li>Create a Qualifier.</li>
                <li>Use Qualifier in Module</li>
                <li><pre class="prettyprint" data-lang="java">
@Provides
@Singleton
@GType("1")
CharG provideG1(CharF f) {
    return new CharG(f, 1);
}

@Provides
@Singleton
@GType("2")
CharG provideG2(CharF f) {
    return new CharG(f, 2);
}
                </pre>
                </li>
            </ul>
        </article>
    </slide>
    <slide>
        <hgroup>
            <h2>Additional Goodies</h2>
            <h3>Qualifiers</h3>
        </hgroup>
        <article class="smaller">
            <p>What if a module has to return 2 different objects of the same class?<br />Let's say 2 different G's in the Word "Dagger".</p>
            <ul>
                <li>Create a Qualifier.</li>
                <li>Use Qualifier in Module</li>
                <li>Expose all you want in your Component</li>
                <li><pre class="prettyprint" data-lang="java">
public interface ApplicationComponent {
    ...
    @GType("1")
    CharG getG1();
    @GType("2")
    CharG getG2();
    ...
</pre>
                </li>
            </ul>
        </article>
    </slide>
        <slide>
        <hgroup>
            <h2>Additional Goodies</h2>
            <h3>Qualifiers</h3>
        </hgroup>
        <article class="smaller">
            <p>What if a module has to return 2 different objects of the same class?<br />Let's say 2 different G's in the Word "Dagger".</p>
            <ul>
                <li>Create a Qualifier.</li>
                <li>Use Qualifier in Module</li>
                <li>Expose all you want in your Component</li>
                <li>Inject using the qualifier</li>
                <li><pre class="prettyprint" data-lang="java">
public class MainActivity extends AppCompatActivity {
    ...
    @Inject
    @GType("1")
    CharG g1;
    @Inject
    @GType("2")
    CharG g2;
    ...
</pre>
Tag: <a href="https://github.com/andretietz/dagger2-introduction/blob/qualifiers/app/src/main/java/eu/unicate/dagger2showcase/MainActivity.java#L26">qualifiers</a>
                </li>
            </ul>
        </article>
    </slide>


    <slide class="thank-you-slide nobackground">
        <aside class="gdbar right"><img src="images/gdg-hamburg-android/small.png"></aside>
        <article class="flexbox vcenter auto-fadein">
            <img style="position: absolute; width:300px; left: 60px; top: 150px"
                 src="images/dagger2/dagger2-intro-github.png"/>

            <h2>Thank You!</h2>

        </article>
        <p class="auto-fadein" data-config-contact>
            <!-- populated from slide_config.json -->
        </p>
    </slide>

    <slide class="backdrop"></slide>

</slides>

<!--<script>-->
<!--var _gaq = _gaq || [];-->
<!--_gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);-->
<!--_gaq.push(['_trackPageview']);-->

<!--(function() {-->
<!--var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;-->
<!--ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';-->
<!--var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);-->
<!--})();-->

<!--</script>-->

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
<script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
